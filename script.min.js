$(document).ready(function(){let e=$(".disabled-element"),n=$("#numbers"),t=$(".entries"),r=$("#yourAnswer"),s=$("#message"),u="Correct",m="Incorrect",c=$("#controls").outerHeight();$("#display").css("height",`calc(100svh - ${c}px)`);let i=["#1a1a1a","#ff5d52","#fedc09","#b1c642","#68b9d8","#023047","#fb8500","#e63946","#588157","#8338ec"],a=i.length,l={compliments:$("#compliments").val(),numDigits:parseInt($("#digits").val()),numRows:parseInt($("#rows").val()),timeInterval:parseInt($("#time").val()),includeSubtractions:$("#subtractions").prop("checked"),speakNumbers:$("#speak").prop("checked")};$("#settings_save").click(function(){l.numDigits=parseInt($("#digits").val()),l.numRows=parseInt($("#rows").val()),l.timeInterval=parseInt($("#time").val()),l.includeSubtractions=$("#subtractions").prop("checked"),l.speakNumbers=$("#speak").prop("checked"),l.compliments=$("#compliments").val(),b()}),$("#setting_form").validate(),$("#setting_form input").on("input",function(){let e=$(this).valid();$("#settings_save, .btn-close").prop("disabled",!e)});let o={start:1,end:5,maxSum:9,minSum:0};b();let d={currentIndex:0,numbers:[],playnum:null,currentAnswer:0,entryAdded:!1};function b(){let e=l.compliments,n=l.numDigits,t=10**n/10;"direct"===e?(o.start=1*t,o.end=5*t,o.minSum=0,o.maxSum=10*t-1):"5_comp"===e?(o.start=1*t,o.end=5*t,o.minSum=5*t,o.maxSum=10*t-1):(o.start=1*t,o.end=10*t,o.minSum=null,o.maxSum=null)}function p(e,n=null){return n?Math.floor(Math.random()*(e-n+1)+n):Math.floor(Math.random()*e)}function f(){(e.prop("disabled",!0),s.text(""),n.hide(),d.currentIndex<d.numbers.length)?(n.fadeIn().text(d.numbers[d.currentIndex]),n.css("color",i[Math.floor(Math.random()*a)]),l.speakNumbers?v(d.numbers[d.currentIndex]):d.currentIndex++):(clearInterval(d.playnum),n.css("color",i[0]),n.fadeIn().text("?"),e.prop("disabled",!1),r.focus(),d.entryAdded||function e(n){let r=n.map((e,n)=>e>=0?0===n?e:` + ${Math.abs(e)}`:` - ${Math.abs(e)}`).join("");t.append(`${r}<br />`),d.entryAdded=!0}(d.numbers))}$("#play").click(function(){d.currentIndex=0,l.numDigits,d.numbers=Array.from({length:l.numRows},(e,n)=>{let t=()=>p(o.end,o.start),r=l.includeSubtractions&&.5>Math.random()&&n>0?-t():t();return r}),function e(){d.currentAnswer=d.numbers.reduce((e,n)=>e+n,0);let n=l.compliments;"direct"===n&&d.currentAnswer>o.maxSum?(d.numbers=d.numbers.map(e=>p(o.end,o.start)),d.numbers[0]=0===d.numbers[0]&&d.numbers[1]<0?Math.abs(d.numbers[1]):d.numbers[0],e()):"5_comp"===n&&(d.currentAnswer>o.maxSum||d.currentAnswer<o.minSum)?(d.numbers=d.numbers.map(e=>p(o.end,o.start)),e()):d.currentAnswer<0&&(d.numbers=d.numbers.map((e,n)=>.5>Math.random()&&n>0?-e:e),e());let t=d.numbers.some(e=>e<0);if(l.includeSubtractions&&!t){let r=d.numbers.reduce((e,n)=>Math.min(e,n));if(r>=0){let s=d.numbers.indexOf(r);s=0===s?s+1:s,d.numbers[s]=-r,d.currentAnswer=d.numbers.reduce((e,n)=>e+n,0)}}}(),d.entryAdded=!1,r.val(""),l.speakNumbers?f():d.playnum=setInterval(f,l.timeInterval)}),$("#replay").click(function(){d.currentIndex=0,r.val(""),l.speakNumbers?f():d.playnum=setInterval(f,l.timeInterval)}),$("#check").click(function(){d.currentAnswer==r.val()?(s.text(u),l.speakNumbers&&v(u)):(s.text(m),l.speakNumbers&&v(m))});let _=[];function v(e){let n=new SpeechSynthesisUtterance;n.voice=_[2],n.rate=1.5,n.pitch=1,n.lang="en-US",n.text=e,l.speakNumbers&&(n.onend=function(){d.currentIndex++,d.currentIndex<=d.numbers.length&&setTimeout(f,l.timeInterval)}),speechSynthesis.speak(n)}speechSynthesis.onvoiceschanged=function(){_=speechSynthesis.getVoices()}});