$(document).ready(function(){let e=$(".disabled-element"),n=$("#numbers"),t=$(".entries"),r=$("#yourAnswer"),s=$("#message"),u="Correct",c="Incorrect",i=$("#controls").outerHeight();$("#display").css("height",`calc(100svh - ${i}px)`);let a={numDigits:parseInt($("#digits").val()),numRows:parseInt($("#rows").val()),timeInterval:parseInt($("#time").val()),includeSubtractions:$("#subtractions").prop("checked"),speakNumbers:$("#speak").prop("checked")};$("#settings_save").click(function(){a.numDigits=parseInt($("#digits").val()),a.numRows=parseInt($("#rows").val()),a.timeInterval=parseInt($("#time").val()),a.includeSubtractions=$("#subtractions").prop("checked"),a.speakNumbers=$("#speak").prop("checked")}),$("#setting_form").validate(),$("#setting_form input").on("input",function(){let e=$(this).valid();$("#settings_save, .btn-close").prop("disabled",!e)});let l={currentIndex:0,numbers:[],playnum:null,currentAnswer:0,entryAdded:!1};function o(){m(),l.currentIndex<l.numbers.length?(n.fadeIn().text(l.numbers[l.currentIndex]),l.currentIndex++):(clearInterval(l.playnum),p())}function d(){m(),l.currentIndex<l.numbers.length?(n.fadeIn().text(l.numbers[l.currentIndex]),f(l.numbers[l.currentIndex])):p()}function m(){e.prop("disabled",!0),s.text(""),n.hide()}function p(){n.fadeIn().text("?"),e.prop("disabled",!1),r.focus(),l.entryAdded||function e(n){let r=n.map((e,n)=>e>=0?0===n?e:` + ${Math.abs(e)}`:` - ${Math.abs(e)}`).join("");t.append(`${r}<br />`),l.entryAdded=!0}(l.numbers)}$("#play").click(function(){l.currentIndex=0,l.numbers=Array.from({length:a.numRows},()=>{let e="";for(let n=0;n<a.numDigits;n++)e+=Math.floor(10*Math.random());return a.includeSubtractions&&.5>Math.random()?-parseInt(e):parseInt(e)}),l.currentAnswer=l.numbers.reduce((e,n)=>e+n,0),l.entryAdded=!1,r.val(""),a.speakNumbers?d():l.playnum=setInterval(o,a.timeInterval)}),$("#replay").click(function(){l.currentIndex=0,r.val(""),a.speakNumbers?d():l.playnum=setInterval(o,a.timeInterval)}),$("#check").click(function(){l.currentAnswer==r.val()?(s.text(u),a.speakNumbers&&f(u)):(s.text(c),a.speakNumbers&&f(c))});let b=[];function f(e){let n=new SpeechSynthesisUtterance;n.voice=b[2],n.rate=1.5,n.pitch=1,n.lang="en-US",n.text=e,a.speakNumbers&&(n.onend=function(){l.currentIndex++,l.currentIndex<=l.numbers.length&&setTimeout(d,a.timeInterval)}),speechSynthesis.speak(n)}speechSynthesis.onvoiceschanged=function(){b=speechSynthesis.getVoices()}});