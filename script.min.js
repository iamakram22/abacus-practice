$(document).ready(function(){let e=$(".disabled-element"),n=$("#numbers"),t=$(".entries"),r=$("#yourAnswer"),u=$("#message"),s="Correct",c="Incorrect",i=$("#controls").outerHeight();$("#display").css("height",`calc(100svh - ${i}px)`);let m=["#1a1a1a","#ff5d52","#fedc09","#b1c642","#68b9d8","#023047","#fb8500","#e63946","#588157","#8338ec"],l=m.length,o=[[2,2,5],[1,1,2,5],[1,3,5],[1,1,2],[5,4],[6,1,2],[6,1,1,1],[7,2],[7,1,1],[8,1],[1,1,1,1,5],[2,1,5],[1,1,1,5],[6,2],[6,1,1],[2,2],[6,1,2],[3,5],[2,5],[1,1,5],[6,1],[1,5],[5,1],[1,1,1,1],[1,2,1],[2,2],[3,1],[1,1,1],[2,1],[1,1]],a=o,d={compliments:$("#compliments").val(),numDigits:parseInt($("#digits").val()),numRows:parseInt($("#rows").val()),timeInterval:parseInt($("#time").val()),includeSubtractions:$("#subtractions").prop("checked"),speakNumbers:$("#speak").prop("checked")},_={start:1,end:5,maxSum:9,minSum:0};function p(e,n=null){return n?Math.floor(Math.random()*(e-n+1)+n):Math.floor(Math.random()*e)}f(),$("#settings_save").click(function(){d.numDigits=parseInt($("#digits").val()),d.numRows=parseInt($("#rows").val()),d.timeInterval=parseInt($("#time").val()),d.includeSubtractions=$("#subtractions").prop("checked"),d.speakNumbers=$("#speak").prop("checked"),d.compliments=$("#compliments").val(),"direct"===d.compliments&&(a=function e(n){n=o;let t=[];for(let r of n){let u=r.map(e=>{let n=parseInt(e.toString().repeat(d.numDigits));return n});t.push(u)}return t}(a)),f()}),$("#setting_form").validate(),$("#setting_form input").on("input",function(){let e=$(this).valid();$("#settings_save, .btn-close").prop("disabled",!e)});let b={currentIndex:0,numbers:[],playnum:null,currentAnswer:0,entryAdded:!1};function f(){let e=d.compliments,n=d.numDigits,t=10**n/10;_.start=t,"5_comp"===e?(_.end=5*t,_.minSum=5,_.maxSum=10*t-1):(_.end=10*t,_.minSum=null,_.maxSum=null)}function v(){(e.prop("disabled",!0),u.text(""),n.hide(),b.currentIndex<b.numbers.length)?(n.fadeIn().text(b.numbers[b.currentIndex]),n.css("color",m[Math.floor(Math.random()*l)]),d.speakNumbers?x(b.numbers[b.currentIndex]):b.currentIndex++):(clearInterval(b.playnum),n.css("color",m[0]),n.fadeIn().text("?"),e.prop("disabled",!1),r.focus(),b.entryAdded||function e(n){let r=n.map((e,n)=>e>=0?0===n?e:` + ${Math.abs(e)}`:` - ${Math.abs(e)}`).join("");t.append(`${r}<br />`),b.entryAdded=!0}(b.numbers))}$("#play").click(function(){b.currentIndex=0,function e(){if("direct"===d.compliments){var n;let t=(n=a)[p(n.length)];return b.numbers=d.includeSubtractions?function e(n){let t=[];t[0]=n[0];for(let r=1;r<n.length;r++){if(5!==n[r]){t[r]=-n[r];t.reduce((e,n)=>e+n,0)>=0&&(n[r]=t[r])}}return n}(t):t,b.numbers}b.numbers=Array.from({length:d.numRows},(e,n)=>{let t=()=>p(_.end,_.start),r=d.includeSubtractions&&.5>Math.random()&&n>0?-t():t();return r})}(),function e(){b.currentAnswer=b.numbers.reduce((e,n)=>e+n,0);let n=d.compliments;if("direct"===n)return;"5_comp"===n&&(b.currentAnswer>_.maxSum||b.currentAnswer<_.minSum)?(b.numbers=b.numbers.map(e=>p(_.end,_.start)),e()):b.currentAnswer<0&&(b.numbers=b.numbers.map((e,n)=>.5>Math.random()&&n>0?-e:e),e());let t=b.numbers.some(e=>e<0);if(d.includeSubtractions&&!t){let r=b.numbers.reduce((e,n)=>Math.min(e,n));if(r>=0){let u=b.numbers.indexOf(r);u=0===u?u+1:u,b.numbers[u]=-r,b.currentAnswer=b.numbers.reduce((e,n)=>e+n,0)}}}(),b.entryAdded=!1,r.val(""),d.speakNumbers?v():b.playnum=setInterval(v,d.timeInterval)}),$("#replay").click(function(){b.currentIndex=0,r.val(""),d.speakNumbers?v():b.playnum=setInterval(v,d.timeInterval)}),$("#check").click(function(){b.currentAnswer==r.val()?(u.text(s),d.speakNumbers&&x(s)):(u.text(c),d.speakNumbers&&x(c))});let g=[];function x(e){let n=new SpeechSynthesisUtterance;n.voice=g[2],n.rate=1.5,n.pitch=1,n.lang="en-US",n.text=e,d.speakNumbers&&(n.onend=function(){b.currentIndex++,b.currentIndex<=b.numbers.length&&setTimeout(v,d.timeInterval)}),speechSynthesis.speak(n)}speechSynthesis.onvoiceschanged=function(){g=speechSynthesis.getVoices()}});