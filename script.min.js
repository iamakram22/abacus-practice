import{colors as e,directSumsPositive as n,directSumsNegative as t}from"./predefined.js";$(document).ready(function(){let r=$(".disabled-element"),s=$("#numbers"),u=$(".entries"),i=$("#yourAnswer"),m=$("#message"),c=$("#compliments"),l=$("#rows"),o="Correct",a="Incorrect",d=$("#controls").outerHeight();$("#display").css("height",`calc(100svh - ${d}px)`);let p=e.length,b={compliments:$("#compliments").val(),numDigits:parseInt($("#digits").val()),numRows:parseInt($("#rows").val()),timeInterval:parseInt($("#time").val()),includeSubtractions:$("#subtractions").prop("checked"),speakNumbers:$("#speak").prop("checked")},f={start:1,end:5,maxSum:9,minSum:0};k();let g;function v(e,n=null){return n?Math.floor(Math.random()*(e-n)+n):Math.floor(Math.random()*e)}function h(e){e=b.includeSubtractions?t:n;let r=[],s=e=>e.toString().repeat(b.numDigits);for(let u of e){let i=u.map(e=>{let n=e<0?-parseInt(s(Math.abs(e))):parseInt(s(e));return n});r.push(i)}return r}$("#settings_save").click(function(e){b.numDigits=parseInt($("#digits").val()),b.numRows=$("#rows").val()>6?6:parseInt($("#rows").val()),b.timeInterval=parseInt($("#time").val()),b.includeSubtractions=$("#subtractions").prop("checked"),b.speakNumbers=$("#speak").prop("checked"),b.compliments=$("#compliments").val(),"direct"===b.compliments&&(g=(g=b.includeSubtractions?h(t):h(n)).filter(e=>e.length===b.numRows)),k()}),$("#setting_form").validate(),$("#setting_form input").on("input",function(){let e=$(this).valid();$("#settings_save, .btn-close").prop("disabled",!e)}),c.on("change",function(){"direct"===$(this).val()?b.includeSubtractions||l.attr("max",6).val(2):l.attr("max",10)});let x={currentIndex:0,numbers:[],playnum:null,currentAnswer:0,entryAdded:!1};function k(){let e=b.compliments,n=b.numDigits,t=10**n/10;f.start=t,"5_comp"===e?(f.end=5*t,f.minSum=5,f.maxSum=10*t-1):(f.end=10*t,f.minSum=null,f.maxSum=null)}function w(){(r.prop("disabled",!0),m.text(""),s.hide(),x.currentIndex<x.numbers.length)?(s.fadeIn().text(x.numbers[x.currentIndex]),s.css("color",e[Math.floor(Math.random()*p)]),b.speakNumbers?S(x.numbers[x.currentIndex]):x.currentIndex++):(clearInterval(x.playnum),s.css("color",e[0]),s.fadeIn().text("?"),r.prop("disabled",!1),i.focus(),x.entryAdded||function e(n){let t=n.map((e,n)=>e>=0?0===n?e:` + ${Math.abs(e)}`:` - ${Math.abs(e)}`).join("");u.append(`${t}<br />`),x.entryAdded=!0}(x.numbers))}$("#play").click(function(){x.currentIndex=0,function e(){if("direct"===b.compliments)return x.numbers=function e(n){let t=n.filter(e=>e.length===b.numRows);return t[v(t.length)]}(g),x.numbers;x.numbers=Array.from({length:b.numRows},(e,n)=>{let t=()=>v(f.end,f.start),r=b.includeSubtractions&&.5>Math.random()&&n>0?-t():t();return r});let n=[];for(let t=0;t<x.numbers.length;t++){n[t]=x.numbers[t];0>n.reduce((e,n)=>e+n,0)&&n[t]<0&&(x.numbers[t]=Math.abs(x.numbers[t]))}}(),function e(){x.currentAnswer=x.numbers.reduce((e,n)=>e+n,0);let n=b.compliments;if("direct"===n)return;"5_comp"===n&&(x.currentAnswer>f.maxSum||x.currentAnswer<f.minSum)?(x.numbers=x.numbers.map(e=>v(f.end,f.start)),e()):x.currentAnswer<0&&(x.numbers=x.numbers.map((e,n)=>.5>Math.random()&&n>0?-e:e),e());let t=x.numbers.some(e=>e<0);if(b.includeSubtractions&&!t){let r=x.numbers.reduce((e,n)=>Math.min(e,n));if(r>=0){let s=x.numbers.indexOf(r);s=0===s?s+1:s,x.numbers[s]=-r,x.currentAnswer=x.numbers.reduce((e,n)=>e+n,0)}}}(),x.entryAdded=!1,i.val(""),b.speakNumbers?w():x.playnum=setInterval(w,b.timeInterval)}),$("#replay").click(function(){x.currentIndex=0,i.val(""),b.speakNumbers?w():x.playnum=setInterval(w,b.timeInterval)}),$("#check").click(function(){x.currentAnswer==i.val()?(m.text(o),b.speakNumbers&&S(o)):(m.text(a),b.speakNumbers&&S(a))});let I=[];function S(e){let n=new SpeechSynthesisUtterance;n.voice=I[2],n.rate=1.5,n.pitch=1,n.lang="en-US",n.text=e,b.speakNumbers&&(n.onend=function(){x.currentIndex++,x.currentIndex<=x.numbers.length&&setTimeout(w,b.timeInterval)}),speechSynthesis.speak(n)}speechSynthesis.onvoiceschanged=function(){I=speechSynthesis.getVoices()}});