$(document).ready(function(){let e=$(".disabled-element"),n=$("#numbers"),t=$(".entries"),r=$("#yourAnswer"),s=$("#message"),u=$("#compliments"),c=$("#rows"),i="Correct",m="Incorrect",l=$("#controls").outerHeight();$("#display").css("height",`calc(100svh - ${l}px)`);let o=["#1a1a1a","#ff5d52","#fedc09","#b1c642","#68b9d8","#023047","#fb8500","#e63946","#588157","#8338ec"],a=o.length,d=[[2,2,5],[1,1,2,5],[1,3,5],[1,1,2],[5,4],[6,1,2],[6,1,1,1],[7,2],[7,1,1],[8,1],[1,1,1,1,5],[2,1,5],[1,1,1,5],[6,2],[6,1,1],[2,2],[6,1,2],[3,5],[2,5],[1,1,5],[6,1],[1,5],[5,1],[1,1,1,1],[1,2,1],[2,2],[3,1],[1,1,1],[2,1],[1,1]],_=d,p={compliments:$("#compliments").val(),numDigits:parseInt($("#digits").val()),numRows:parseInt($("#rows").val()),timeInterval:parseInt($("#time").val()),includeSubtractions:$("#subtractions").prop("checked"),speakNumbers:$("#speak").prop("checked")},b={start:1,end:5,maxSum:9,minSum:0};function f(e,n=null){return n?Math.floor(Math.random()*(e-n)+n):Math.floor(Math.random()*e)}h(),$("#settings_save").click(function(){p.numDigits=parseInt($("#digits").val()),p.numRows=parseInt($("#rows").val()),p.timeInterval=parseInt($("#time").val()),p.includeSubtractions=$("#subtractions").prop("checked"),p.speakNumbers=$("#speak").prop("checked"),p.compliments=$("#compliments").val(),"direct"===p.compliments&&(_=function e(n){n=d;let t=[];for(let r of n){let s=r.map(e=>{let n=parseInt(e.toString().repeat(p.numDigits));return n});t.push(s)}return t}(_)),h()}),$("#setting_form").validate(),$("#setting_form input").on("input",function(){let e=$(this).valid();$("#settings_save, .btn-close").prop("disabled",!e)}),u.on("change",function(){"direct"===$(this).val()?c.parent().hide():c.parent().show()});let g={currentIndex:0,numbers:[],playnum:null,currentAnswer:0,entryAdded:!1};function h(){let e=p.compliments,n=p.numDigits,t=10**n/10;b.start=t,"5_comp"===e?(b.end=5*t,b.minSum=5,b.maxSum=10*t-1):(b.end=10*t,b.minSum=null,b.maxSum=null)}function v(){(e.prop("disabled",!0),s.text(""),n.hide(),g.currentIndex<g.numbers.length)?(n.fadeIn().text(g.numbers[g.currentIndex]),n.css("color",o[Math.floor(Math.random()*a)]),p.speakNumbers?k(g.numbers[g.currentIndex]):g.currentIndex++):(clearInterval(g.playnum),n.css("color",o[0]),n.fadeIn().text("?"),e.prop("disabled",!1),r.focus(),g.entryAdded||function e(n){let r=n.map((e,n)=>e>=0?0===n?e:` + ${Math.abs(e)}`:` - ${Math.abs(e)}`).join("");t.append(`${r}<br />`),g.entryAdded=!0}(g.numbers))}$("#play").click(function(){g.currentIndex=0,function e(){if("direct"===p.compliments){var n;let t=(n=_)[f(n.length)];return g.numbers=p.includeSubtractions?function e(n){let t=[];t[0]=n[0];for(let r=1;r<n.length;r++){if(5!==n[r]){t[r]=-n[r];t.reduce((e,n)=>e+n,0)>=0&&(n[r]=t[r])}}return n}(t):t,g.numbers}g.numbers=Array.from({length:p.numRows},(e,n)=>{let t=()=>f(b.end,b.start),r=p.includeSubtractions&&.5>Math.random()&&n>0?-t():t();return r});let r=[];for(let s=0;s<g.numbers.length;s++){r[s]=g.numbers[s];0>r.reduce((e,n)=>e+n,0)&&r[s]<0&&(g.numbers[s]=Math.abs(g.numbers[s]))}}(),function e(){g.currentAnswer=g.numbers.reduce((e,n)=>e+n,0);let n=p.compliments;if("direct"===n)return;"5_comp"===n&&(g.currentAnswer>b.maxSum||g.currentAnswer<b.minSum)?(g.numbers=g.numbers.map(e=>f(b.end,b.start)),e()):g.currentAnswer<0&&(g.numbers=g.numbers.map((e,n)=>.5>Math.random()&&n>0?-e:e),e());let t=g.numbers.some(e=>e<0);if(p.includeSubtractions&&!t){let r=g.numbers.reduce((e,n)=>Math.min(e,n));if(r>=0){let s=g.numbers.indexOf(r);s=0===s?s+1:s,g.numbers[s]=-r,g.currentAnswer=g.numbers.reduce((e,n)=>e+n,0)}}}(),g.entryAdded=!1,r.val(""),p.speakNumbers?v():g.playnum=setInterval(v,p.timeInterval)}),$("#replay").click(function(){g.currentIndex=0,r.val(""),p.speakNumbers?v():g.playnum=setInterval(v,p.timeInterval)}),$("#check").click(function(){g.currentAnswer==r.val()?(s.text(i),p.speakNumbers&&k(i)):(s.text(m),p.speakNumbers&&k(m))});let x=[];function k(e){let n=new SpeechSynthesisUtterance;n.voice=x[2],n.rate=1.5,n.pitch=1,n.lang="en-US",n.text=e,p.speakNumbers&&(n.onend=function(){g.currentIndex++,g.currentIndex<=g.numbers.length&&setTimeout(v,p.timeInterval)}),speechSynthesis.speak(n)}speechSynthesis.onvoiceschanged=function(){x=speechSynthesis.getVoices()}});